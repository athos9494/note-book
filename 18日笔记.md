# Linux文件与目录的默认权限与隐藏权限

## 文件的默认权限：umask

`umask`是指定目前使用者在创建文件或目录时候的权限默认值，`umask`显示的数值代表被拿掉的权限。 

查阅权限默认值有两种方式：

- 　直接输入`umask`，可以显示数字形态的权限配置分数`0022`，第一组是特殊权限用的，后面三组才是默认创建文件的默认权限；
- `umask -S`，一符号类型的方式显示权限`u=rwx,g=rx,o=rx`

目录与文件的默认权限属性上是不一样的

- 新建文件默认是没有可运行`X`权限，只有`rw`,默认权限是`-rw-rw-rw-`

- 新建目录，默认所有权限都是开放，默认权限就是`drwxrwxrwx`

`umask`结果是`022`,说明user有全部权限，group和others的权限被拿掉了`W`，使用者创建：

- 新文件：由于文件本身默认没有`x`权限，所以新文件的权限就是 `-rw-r--r--`

- 新目录：新目录默认是有`x`权限的，所以新目录默认权限就是`drwxr-xr-x`

### umask的利用与重要性：专题制作

在一个群组内文件默认只有`-rw-r--r--`，其他人就没办法在使用者创建的文件上进行编辑家操作，`umask 002`,就可以赋予同群组人`w`的权限，文件的权限就重定义成了`-rw-rw-r--`

## 文件隐藏属性：`chatter`、`lsattr`

- chatter(配置文件隐藏属性)
    
> chattr [+-=][ASacdistu]文件或目录名称

选项 | 参数
:---: | ---
+  | 添加某一个特殊参数，其他原本存在参数则不动。
-  | 移除某一个特殊参数，其他原本存在参数则不动。
=  | 配置一定，且仅有后面接的参数
A  | 当配置了 A 这个属性时，若你有存取此文件(或目录)时，他的存取时间 atime将不会被修改，可避免I/O较慢的机器过度的存取硬盘。这对速度较慢的计算机有帮助
S  | 一般文件是非同步写入磁碟的，如果加上 S 这个属性时，当你进行任何文件的修改，该更动会同步写入磁碟中。
a  | 当配置 a 之后，这个文件将只能添加数据，而不能删除也不能修改数据，只有root 才能配置这个属性
c  | 这个属性配置之后，将会自动的将此文件压缩，在读取的时候将会自动解压缩，但是在储存的时候，将会先进压缩才存储。
d | 当 dump 程序被运行的时候，配置 d 属性将可使该文件(或目录)不会被 dump 备份
i  | 让一个文件『不能被删除、改名、配置连结也无法写入或新增数据，对於系统安全性有相当大的助益，只有 root 能配置此属性
s | 当文件配置了 s 属性时，如果这个文件被删除，他将会被完全的移除出这个硬盘空间，所以如果误删，无法恢复
u  | 与 s 相反的，当使用 u 来配置文件时，如果该文件被删除了，则数据内容其实还存在硬盘中，可以使用来恢复

- lsattr(显示文件隐藏属性)
    使用 `chattr` 配置后，可以利用 `lsattr` 来查阅隐藏的属性。
> lsattr [-adR]文件或目录

选项 | 参数
:-: | :-:
-a | 将隐藏档的属性列出来
-d | 如果接的是目录，仅列出目录本身的属性而非目录内的档名
-R | 连同子目录的数据也一并列出来





## 文件特殊权限：`SUID`、`SGID`、`SBIT`、权限配置

### Set UID:

当 s 这个标志出现在文件拥有者的 x 权限上时,比如`-rwsr-xr-x`,此时就是`Set UID`,简称`SUID`.且SUID 对於目录是无效
SUID的权限对於一个文件的特殊功能:

- SUID 权限仅对二进位程序(binary program)有效；
- 运行者对於该程序需要具有 `x` 的可运行权限；
- 本权限仅在运行该程序的过程中有效 (run-time)；
- 运行者将具有该程序拥有者 (owner) 的权限。

### Set GID

针对群组在`x`的权限就是SGID，针对文件目录都可以使用来操作
- 针对文件，它有以下功能：
    - SGID 对二进位程序有用
    - 程序运行者对於该程序来说，需具备 `x` 的权限
    - 运行者在运行的过程中将会获得该程序群组的支持

- 针对目录它有以下功能：

    - 使用者若对於此目录具有 `r` 与 `x` 的权限时，该使用者能够进入此目录；
    - 使用者在此目录下的有效群组(effective group)将会变成该目录的群组；
    - 用途：若使用者在此目录下具有 `w` 的权限(可以新建文件)，则使用者所创建的新文件，该新文件的群组与此目录的群组相同


### Sticky Bit

SBIT 目前只针对目录有效,SBIT 对於目录的作用是：
- 当使用者对於此目录具有 `w` ` x` 权限，亦即具有写入的权限时；
- 当使用者在该目录下创建文件或目录时，仅有自己与 root 才有权力删除该文件

简单来说就是当甲这个使用者在 A 目录是具有群组或其他人的身份，并且拥有该目录 `w` 的权限， 这表示甲使用者对该目录内任何人创建的目录或文件均可进行 `删除` `更名` `搬移` 等动作。 不过，如果将 A 目录加上了 SBIT 的权限项目时， 则甲只能够针对自己创建的文件或目录进行`删除` `更名` `移动`等动作，而无法删除他人的文件。

### SUID/SGID/SBIT 权限配置

SUID 为 `u+s` ，而 SGID 为 `g+s` ，SBIT 则是 `o+t` 

指令即是：
> chmod u+s,g+s,o+t filename





## 观察文件类型：`file`

想要知道某个文件的基本数据，例如是属 `ASCII` 或者是 `data` 文件，或者是 binary ， 且其中有没有使用到动态函式库 (share library) 等等的资讯，就可以利用 file 这个命令来检阅.

> file filename 

---

# 命令与文件的搜寻

## 命令档名的搜寻：`which`
想要知道指令完整档名在哪，可以通过`which`或`type`实现功能。

举例：

> which ls

终端给出的回馈就是

> /bin/ls

同样的type

> type ls

输出就是

> ls is hashed (/bin/ls)




## 文件档名的搜寻：`whereis` `locate` `find`

### whereis (寻找特定文件)

> whereis [-bmsu] 文件或目录名

选项 | 参数
:---:|:---:
-b | 只找 `binary` (可运行档)格式的文件
-m | 只找在说明档 `manual` 路径下的文件
-s | 只找 `source` 来源文件
-u | 搜寻不在上述三个项目当中的其他特殊文件 

### locate

> locate [-ir] keyword

选项|参数
:---:|:---:
-i | 忽略大小写的差异；
-r | 后面可接正规表示法的显示方式

`locate 只能在已创建的数据库 /var/lib/mlocate/ 里面寻找数据`

### find

> find [路径] [option] [action]

与时间有关的选项共有 `-atime`  `-ctime` 与 `mtime` ，以 `-mtime` 说明

选项 | 参数
:---:|:---:
-mtime  n | n 为数字，意义为在 n 天之前的一天之内被更动过内容的文件；
-mtime +n | 列出在 n 天之前(不含 n 天本身)被更动过内容的文件档名；
-mtime -n | 列出在 n 天之内(含 n 天本身)被更动过内容的文件档名。
-newer file | file 为一个存在的文件，列出比 file 还要新的文件档名

> find / -mtime 0

0 代表目前的时间，所以，从现在开始到 24 小时前，
有变动过内容的文件都会被列出来！那如果是三天前的 24 小时内？
> find / -mtime 3 有变动过的文件都被列出的意思

> find /etc -newer /etc/passwd </br>-newer 用在分辨两个文件之间的新旧关系是很有用的.

> find [path] -mtime 4

-  `+4`代表大於等於5天前的档名：find /var -mtime +4
-  `-4`代表小於等於4天内的文件档名：find /var -mtime -4
- `4`则是代表4-5那一天的文件档名：find /var -mtime 4






---

# 权限与命令之间的关系

权限对於使用者帐号来说非常重要，他可以限制使用者能不能`读取` `创建` `删除` `修改`文件或目录
### 让使用者能进入某目录成为可工作目录的基本权限为:
- 可使用的命令：例如 `cd` 等变换工作目录的命令；
- 目录所需权限：使用者对这个目录至少需要具有 `x` 的权限
- 额外需求：如果使用者想要在这个目录内利用 `ls` 查阅档名，则使用者对此目录还需要 `r` 的权限

### 使用者在某个目录内读取一个文件的基本权限为:
- 可使用的命令：例如本章谈到的 `cat`  `more`  `less`等
- 目录所需权限：使用者对这个目录至少需要具有 `x` 权限
- 文件所需权限：使用者对文件至少需要具有 `r` 的权限才行

### 让使用者可以修改一个文件的基本权限为:

- 可使用的命令：例如 `nano` 或未来要介绍的 `vi` 编辑器等；
- 目录所需权限：使用者在该文件所在的目录至少要有 `x` 权限；
- 文件所需权限：使用者对该文件至少要有 `r` `w`权限

### 让一个使用者可以创建一个文件的基本权限为
- 目录所需权限：使用者在该目录要具有`w` `x` 的权限，重点在`w` 

### 让使用者进入某目录并运行该目录下的某个命令之基本权限为:

- 目录所需权限：使用者在该目录至少要有`x`的权限
- 文件所需权限：使用者在该文件至少需要有`x`的权限

---